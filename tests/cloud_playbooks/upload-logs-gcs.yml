---
- hosts: localhost
  become: false
  gather_facts: no

  vars:
    expire: 72000

  tasks:
    - name: replace_test_id
      set_fact:
        test_name: "{{ test_id | regex_replace('\\.', '-') }}"

    - name: Create a bucket
      gc_storage:
        bucket: "{{ test_name }}"
        mode: create
        expiration: "{{ expire }}"
        permission: private

    - name: Upload collected diagnostic info
      gc_storage:
        bucket: "{{ test_name }}"
        mode: put
        permission: private
        expiration: "{{ expire }}"
        object: "build-{{ test_name }}-{{ kube_network_plugin }}-logs.tar.gz"
        src: logs.tar.gz
